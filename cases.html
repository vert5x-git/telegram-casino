<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–µ–π—Å—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 16px;
            color: var(--tg-theme-text-color);
            background: var(--tg-theme-bg-color);
        }

        .container {
            max-width: 390px;
            margin: 0 auto;
        }

        .balance {
            background: var(--tg-theme-secondary-bg-color);
            padding: 16px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: bold;
            color: var(--tg-theme-button-color);
        }

        .cases-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .case-item {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .case-item:hover {
            transform: scale(1.03);
        }

        .case-image {
            width: 100%;
            height: 100px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .case-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .case-price {
            color: var(--tg-theme-button-color);
            font-size: 14px;
        }

        .inventory {
            background: var(--tg-theme-secondary-bg-color);
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .inventory h3 {
            margin: 0 0 12px 0;
            text-align: center;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .inventory-item {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            font-size: 24px;
            position: relative;
            cursor: pointer;
        }

        .inventory-item.rare {
            color: #ff3b30;
        }

        .inventory-item.epic {
            color: #5856d6;
        }

        .inventory-item.legendary {
            color: #ff9500;
        }

        .inventory-item .sell-button {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 10px;
            padding: 2px;
            border-radius: 0 0 6px 6px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .inventory-item:hover .sell-button {
            opacity: 1;
        }

        .open-case-button {
            width: 100%;
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 12px;
        }

        .open-case-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .result {
            background: var(--tg-theme-secondary-bg-color);
            padding: 16px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-size: 16px;
            display: none;
        }

        .win {
            color: #34c759;
            font-weight: bold;
        }

        .lose {
            color: #ff3b30;
        }

        .error {
            color: #ff3b30;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
        }

        .debug {
            background: var(--tg-theme-secondary-bg-color);
            padding: 16px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .credit-button {
            display: none;
            margin-top: 10px;
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .case-opening-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .case-items-container {
            display: flex;
            width: 330px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è —Ç—Ä–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
            height: 100px;
            position: relative;
            overflow: hidden;
        }

        .case-item-animation {
            min-width: 100px;
            height: 100px;
            background: var(--tg-theme-secondary-bg-color);
            margin: 0 5px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            flex-shrink: 0;
        }

        .case-item-animation.rare {
            color: #ff3b30;
        }

        .case-item-animation.epic {
            color: #5856d6;
        }

        .case-item-animation.legendary {
            color: #ff9500;
        }

        .case-items-wrapper {
            display: flex;
            position: absolute;
            left: 0;
            transition: transform 0s linear;
        }

        .case-selector {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 110px;
            transform: translateX(-50%);
            border: 2px solid var(--tg-theme-button-color);
            border-radius: 8px;
            pointer-events: none;
            z-index: 1;
        }

        .case-opening-result {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--tg-theme-secondary-bg-color);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 24px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="balance">
            <div>–í–∞—à –±–∞–ª–∞–Ω—Å:</div>
            <div class="balance-amount">10000 –º–æ–Ω–µ—Ç</div>
            <button class="credit-button" id="creditButton">–í–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç (1000 –º–æ–Ω–µ—Ç)</button>
        </div>

        <div class="cases-container">
            <div class="case-item" data-case="basic" data-price="100">
                <div class="case-image">üì¶</div>
                <div class="case-name">–ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å</div>
                <div class="case-price">100 –º–æ–Ω–µ—Ç</div>
            </div>
            <div class="case-item" data-case="premium" data-price="500">
                <div class="case-image">üíé</div>
                <div class="case-name">–ü—Ä–µ–º–∏—É–º –∫–µ–π—Å</div>
                <div class="case-price">500 –º–æ–Ω–µ—Ç</div>
            </div>
            <div class="case-item" data-case="rare" data-price="1000">
                <div class="case-image">üåü</div>
                <div class="case-name">–†–µ–¥–∫–∏–π –∫–µ–π—Å</div>
                <div class="case-price">1000 –º–æ–Ω–µ—Ç</div>
            </div>
            <div class="case-item" data-case="epic" data-price="2000">
                <div class="case-image">üî•</div>
                <div class="case-name">–≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å</div>
                <div class="case-price">2000 –º–æ–Ω–µ—Ç</div>
            </div>
        </div>

        <div class="inventory">
            <h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
            <div class="inventory-grid" id="inventoryGrid">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
            </div>
        </div>

        <button class="open-case-button" id="openCaseButton" disabled>–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</button>

        <div class="result" id="result"></div>
        <div class="error" id="error"></div>
        <div class="debug" id="debug"></div>

        <div class="case-opening-animation" id="caseOpeningAnimation">
            <div class="case-items-container" id="caseItemsContainer">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–µ–¥–º–µ—Ç—ã –≤–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ -->
            </div>
            <div class="case-opening-result" id="caseOpeningResult"></div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ WebApp —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
        if (!tg) {
            showError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp');
            console.error('Telegram WebApp –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        } else {
            // –í–∫–ª—é—á–∞–µ–º –æ—Ç–ª–∞–¥–∫—É
            tg.enableClosingConfirmation();
            tg.expand();
            
            // –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            showDebug('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
            showDebug('–í–µ—Ä—Å–∏—è: ' + tg.version);
            showDebug('–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ' + tg.platform);
            showDebug('–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞: ' + tg.colorScheme);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
            document.documentElement.style.setProperty('--tg-theme-bg-color', tg.backgroundColor || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-text-color', tg.textColor || '#000000');
            document.documentElement.style.setProperty('--tg-theme-button-color', tg.buttonColor || '#3390ec');
            document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.buttonTextColor || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', tg.secondaryBackgroundColor || '#f0f0f0');
            document.documentElement.style.setProperty('--tg-theme-hint-color', tg.hintColor || '#999999');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞
            tg.onEvent('web_app_data_send', handleBotResponse);
            
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —É –±–æ—Ç–∞
            try {
                tg.sendData(JSON.stringify({ action: 'get_data' }));
                showDebug('–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
            } catch (e) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö: ' + e.message);
                showDebug('–û—à–∏–±–∫–∞: ' + e.message);
            }
        }

        // –ü—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –∫–µ–π—Å–æ–≤
        const ITEMS = {
            basic: [
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 50 },
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 100 },
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 150 },
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 200 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 300 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 400 },
                { name: '–≠–ø–∏—á–µ—Å–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üíé', rarity: 'epic', value: 500 },
                { name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üåü', rarity: 'legendary', value: 1000 }
            ],
            premium: [
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 100 },
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 200 },
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 300 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 400 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 500 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 600 },
                { name: '–≠–ø–∏—á–µ—Å–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üíé', rarity: 'epic', value: 800 },
                { name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üåü', rarity: 'legendary', value: 1500 }
            ],
            rare: [
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 200 },
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 300 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 500 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 600 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 700 },
                { name: '–≠–ø–∏—á–µ—Å–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üíé', rarity: 'epic', value: 1000 },
                { name: '–≠–ø–∏—á–µ—Å–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üíé', rarity: 'epic', value: 1200 },
                { name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üåü', rarity: 'legendary', value: 2000 }
            ],
            epic: [
                { name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', rarity: 'common', value: 300 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 600 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 700 },
                { name: '–†–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üí∞', rarity: 'rare', value: 800 },
                { name: '–≠–ø–∏—á–µ—Å–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üíé', rarity: 'epic', value: 1200 },
                { name: '–≠–ø–∏—á–µ—Å–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üíé', rarity: 'epic', value: 1500 },
                { name: '–≠–ø–∏—á–µ—Å–∫–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üíé', rarity: 'epic', value: 1800 },
                { name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –º–æ–Ω–µ—Ç–∞', emoji: 'üåü', rarity: 'legendary', value: 3000 }
            ]
        };

        // –®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Ä–∞–∑–Ω–æ–π —Ä–µ–¥–∫–æ—Å—Ç–∏
        const RARITY_CHANCES = {
            common: 0.6,    // 60% —à–∞–Ω—Å
            rare: 0.25,     // 25% —à–∞–Ω—Å
            epic: 0.1,      // 10% —à–∞–Ω—Å
            legendary: 0.05  // 5% —à–∞–Ω—Å
        };

        // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–µ–π—Å
        let selectedCase = null;

        // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–≥—Ä–æ–∫–∞
        let inventory = [];

        function showError(message) {
            document.getElementById('error').textContent = message;
            setTimeout(() => {
                document.getElementById('error').textContent = '';
            }, 3000);
        }

        function showDebug(message) {
            document.getElementById('debug').textContent = message;
        }

        function showResult(message, isWin) {
            const resultElement = document.getElementById('result');
            resultElement.textContent = message;
            resultElement.className = isWin ? 'result win' : 'result lose';
            resultElement.style.display = 'block';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            showDebug('–ü–æ–∫–∞–∑–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ' + message + ' (isWin: ' + isWin + ')');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function updateBalance(newBalance) {
            const balanceElement = document.querySelector('.balance-amount');
            const oldBalance = parseInt(balanceElement.textContent);
            balanceElement.textContent = newBalance + ' –º–æ–Ω–µ—Ç';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∫—Ä–µ–¥–∏—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∞–ª–∞–Ω—Å–∞
            const creditButton = document.getElementById('creditButton');
            if (newBalance <= 0) {
                creditButton.style.display = 'block';
            } else {
                creditButton.style.display = 'none';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
            if (oldBalance !== newBalance) {
                balanceElement.style.transition = 'color 0.3s';
                balanceElement.style.color = newBalance > oldBalance ? '#34c759' : '#ff3b30';
                setTimeout(() => {
                    balanceElement.style.transition = 'color 0.3s';
                    balanceElement.style.color = '';
                }, 500);
            }
            
            showDebug('–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ' + newBalance);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function updateInventory(newInventory) {
            inventory = newInventory;
            const inventoryGrid = document.getElementById('inventoryGrid');
            inventoryGrid.innerHTML = '';
            
            if (inventory.length === 0) {
                inventoryGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: var(--tg-theme-hint-color);">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
                return;
            }
            
            inventory.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'inventory-item ' + item.rarity;
                itemElement.textContent = item.emoji;
                itemElement.title = `${item.name} (${item.value} –º–æ–Ω–µ—Ç)`;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–¥–∞–∂–∏
                const sellButton = document.createElement('div');
                sellButton.className = 'sell-button';
                sellButton.textContent = '–ü—Ä–æ–¥–∞—Ç—å';
                sellButton.onclick = (e) => {
                    e.stopPropagation();
                    sellItem(index);
                };
                
                itemElement.appendChild(sellButton);
                inventoryGrid.appendChild(itemElement);
            });
            
            showDebug('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –æ–±–Ω–æ–≤–ª–µ–Ω: ' + JSON.stringify(inventory));
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–µ–π—Å–∞
        function selectCase(caseType) {
            selectedCase = caseType;
            const openCaseButton = document.getElementById('openCaseButton');
            openCaseButton.disabled = false;
            openCaseButton.textContent = `–û—Ç–∫—Ä—ã—Ç—å ${getCaseName(caseType)} (${getCasePrice(caseType)} –º–æ–Ω–µ—Ç)`;
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–µ–π—Å
            document.querySelectorAll('.case-item').forEach(item => {
                if (item.dataset.case === caseType) {
                    item.style.border = '2px solid var(--tg-theme-button-color)';
                } else {
                    item.style.border = 'none';
                }
            });
            
            showDebug('–í—ã–±—Ä–∞–Ω –∫–µ–π—Å: ' + caseType);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–µ–π—Å–∞
        function getCaseName(caseType) {
            switch (caseType) {
                case 'basic': return '–ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å';
                case 'premium': return '–ü—Ä–µ–º–∏—É–º –∫–µ–π—Å';
                case 'rare': return '–†–µ–¥–∫–∏–π –∫–µ–π—Å';
                case 'epic': return '–≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å';
                default: return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–µ–π—Å';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã –∫–µ–π—Å–∞
        function getCasePrice(caseType) {
            switch (caseType) {
                case 'basic': return 100;
                case 'premium': return 500;
                case 'rare': return 1000;
                case 'epic': return 2000;
                default: return 0;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
        function openCase() {
            if (!selectedCase) {
                showError('–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è!');
                return;
            }
            
            const casePrice = getCasePrice(selectedCase);
            const balanceElement = document.querySelector('.balance-amount');
            const currentBalance = parseInt(balanceElement.textContent);
            
            if (currentBalance < casePrice) {
                showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞!');
                return;
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            document.getElementById('result').style.display = 'none';
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
            document.getElementById('openCaseButton').disabled = true;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∫–µ–π—Å–∞
            const item = getRandomItem(selectedCase);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
            showCaseOpeningAnimation(item, () => {
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                const newBalance = currentBalance - casePrice + item.value;
                updateBalance(newBalance);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                inventory.push(item);
                updateInventory(inventory);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                showResult(`–í—ã –ø–æ–ª—É—á–∏–ª–∏: ${item.name} (${item.value} –º–æ–Ω–µ—Ç)`, true);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                try {
                    const data = {
                        action: 'update_data',
                        balance: newBalance,
                        inventory: inventory
                    };
                    tg.sendData(JSON.stringify(data));
                    showDebug('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É: ' + JSON.stringify(data));
                } catch (e) {
                    showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ' + e.message);
                    showDebug('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É: ' + e.message);
                }
                
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
                document.getElementById('openCaseButton').disabled = false;
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –∫–µ–π—Å–∞
        function getRandomItem(caseType) {
            const items = ITEMS[caseType];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–¥–∫–æ—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–Ω—Å–æ–≤
            const rarityRoll = Math.random();
            let selectedRarity;
            
            if (rarityRoll < RARITY_CHANCES.legendary) {
                selectedRarity = 'legendary';
            } else if (rarityRoll < RARITY_CHANCES.legendary + RARITY_CHANCES.epic) {
                selectedRarity = 'epic';
            } else if (rarityRoll < RARITY_CHANCES.legendary + RARITY_CHANCES.epic + RARITY_CHANCES.rare) {
                selectedRarity = 'rare';
            } else {
                selectedRarity = 'common';
            }
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ä–µ–¥–∫–æ—Å—Ç–∏
            const rarityItems = items.filter(item => item.rarity === selectedRarity);
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö
            return rarityItems[Math.floor(Math.random() * rarityItems.length)];
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
        function showCaseOpeningAnimation(item, callback) {
            const animationContainer = document.getElementById('caseOpeningAnimation');
            const itemsContainer = document.getElementById('caseItemsContainer');
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            itemsContainer.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –æ–±–µ—Ä—Ç–∫—É –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            const itemsWrapper = document.createElement('div');
            itemsWrapper.className = 'case-items-wrapper';
            itemsContainer.appendChild(itemsWrapper);
            
            // –°–æ–∑–¥–∞–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –≤—ã–∏–≥—Ä—ã—à–∞
            const selector = document.createElement('div');
            selector.className = 'case-selector';
            itemsContainer.appendChild(selector);
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ (–±–æ–ª—å—à–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –¥–ª–∏–Ω–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏)
            const animationItems = [];
            for (let i = 0; i < 100; i++) {
                const randomCase = Object.keys(ITEMS)[Math.floor(Math.random() * Object.keys(ITEMS).length)];
                const randomItem = ITEMS[randomCase][Math.floor(Math.random() * ITEMS[randomCase].length)];
                animationItems.push(randomItem);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤ –∫–æ–Ω–µ—Ü
            animationItems.push(item);
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            animationItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'case-item-animation ' + item.rarity;
                itemElement.textContent = item.emoji;
                itemsWrapper.appendChild(itemElement);
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            animationContainer.style.display = 'flex';
            
            // –ù–∞—á–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ (–Ω–µ–º–Ω–æ–≥–æ –ø—Ä–∞–≤–µ–µ)
            itemsWrapper.style.transform = 'translateX(100px)';
            
            // –§–æ—Ä—Å–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É
            void itemsWrapper.offsetWidth;
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            setTimeout(() => {
                // –ü–µ—Ä–≤–∞—è –±—ã—Å—Ç—Ä–∞—è —Ñ–∞–∑–∞
                itemsWrapper.style.transition = 'transform 3s cubic-bezier(0.1, 0, 0.9, 1)';
                itemsWrapper.style.transform = 'translateX(-5000px)';
                
                // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞–µ–º —Ñ–∞–∑—É –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                setTimeout(() => {
                    // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–Ω–µ—á–Ω—É—é –ø–æ–∑–∏—Ü–∏—é —Ç–∞–∫, —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –æ–∫–∞–∑–∞–ª—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É
                    const finalPosition = -(animationItems.length - 3) * 110;
                    itemsWrapper.style.transition = 'transform 4s cubic-bezier(0.3, 0.2, 0, 1)';
                    itemsWrapper.style.transform = `translateX(${finalPosition}px)`;
                    
                    // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => {
                        // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤—ã–∏–≥—Ä—ã—à–∞
                        const winningItem = itemsWrapper.children[animationItems.length - 1];
                        winningItem.style.transform = 'scale(1.1)';
                        winningItem.style.boxShadow = '0 0 20px var(--tg-theme-button-color)';
                        
                        // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã —Å–∫—Ä—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                        setTimeout(() => {
                            animationContainer.style.display = 'none';
                            if (callback) callback();
                        }, 2000);
                    }, 4000);
                }, 3000);
            }, 100);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–æ—Ç–∞
        function handleBotResponse(event) {
            try {
                showDebug('–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞: ' + event);
                
                let data;
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å—Ç—Ä–æ–∫–∏
                if (typeof event === 'string') {
                    try {
                        data = JSON.parse(event);
                        showDebug('–†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ' + JSON.stringify(data));
                    } catch (e) {
                        showDebug('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' + e.message);
                        return;
                    }
                } else {
                    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –æ–±—ä–µ–∫—Ç–∞
                    data = event;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω
                if (data && typeof data.balance !== 'undefined') {
                    showDebug('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞: ' + data.balance);
                    updateBalance(data.balance);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω
                if (data && Array.isArray(data.inventory)) {
                    showDebug('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è: ' + JSON.stringify(data.inventory));
                    updateInventory(data.inventory);
                }
                
            } catch (e) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–æ—Ç–∞: ' + e.message);
                showDebug('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ' + e.message);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.querySelectorAll('.case-item').forEach(item => {
            item.addEventListener('click', function() {
                selectCase(this.dataset.case);
            });
        });

        document.getElementById('openCaseButton').addEventListener('click', openCase);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –∫—Ä–µ–¥–∏—Ç–∞
        document.getElementById('creditButton').addEventListener('click', function() {
            const currentBalance = parseInt(document.querySelector('.balance-amount').textContent);
            if (currentBalance <= 0) {
                // –î–æ–±–∞–≤–ª—è–µ–º 1000 –º–æ–Ω–µ—Ç –∫ –±–∞–ª–∞–Ω—Å—É
                const newBalance = currentBalance + 1000;
                updateBalance(newBalance);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
                try {
                    const data = {
                        action: 'update_balance',
                        balance: newBalance,
                        credit_taken: true
                    };
                    tg.sendData(JSON.stringify(data));
                    showDebug('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ –≤–∑—è—Ç–∏–∏ –∫—Ä–µ–¥–∏—Ç–∞: ' + JSON.stringify(data));
                } catch (e) {
                    showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞: ' + e.message);
                    showDebug('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É: ' + e.message);
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø—Ä–µ–¥–º–µ—Ç–∞
        function sellItem(index) {
            if (index < 0 || index >= inventory.length) {
                showError('–ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            const item = inventory[index];
            const balanceElement = document.querySelector('.balance-amount');
            const currentBalance = parseInt(balanceElement.textContent);
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            inventory.splice(index, 1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            const newBalance = currentBalance + item.value;
            updateBalance(newBalance);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            updateInventory(inventory);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            showResult(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${item.name} –∑–∞ ${item.value} –º–æ–Ω–µ—Ç`, true);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            try {
                const data = {
                    action: 'update_data',
                    balance: newBalance,
                    inventory: inventory,
                    item_sold: item
                };
                tg.sendData(JSON.stringify(data));
                showDebug('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–¥–∞–∂–µ –ø—Ä–µ–¥–º–µ—Ç–∞: ' + JSON.stringify(data));
            } catch (e) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ' + e.message);
                showDebug('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É: ' + e.message);
            }
        }
    </script>
</body>
</html> 
